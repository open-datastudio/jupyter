apiVersion: skaffold/v2beta1
kind: Config
build:
  artifacts:
    - image: jupyter
      context: .
      custom:
        # staroid build env allow executable in /var/run.
        buildCommand: >
          echo "image - $IMAGE;" &&
          sudo mkdir /var/run/repo &&
          sudo cp -r * /var/run/repo/ &&
          cd /var/run/repo &&
          sudo ./build.sh &&
          IMAGE=$IMAGE PUSH_IMAGE=$PUSH_IMAGE /var/run/build.sh
deploy:
  kubectl:
    manifests:
      - mlflow-env.yaml
      - k8s.yaml
profiles:
  - name: minikube
    build:
      artifacts:
        - image: jupyter
          context: .
          docker:
            dockerfile: Dockerfile_staroid
    patches:
      - op: add
        path: /deploy/kubectl/manifests/0
        value: minikube.yaml
